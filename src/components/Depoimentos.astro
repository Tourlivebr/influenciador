---
// Dados dos depoimentos
const depoimentos = [
  {
    id: 1,
    nome: "Maria Silva",
    foto: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=150&h=150&fit=crop&crop=face",
    avaliacao: 5,
    comentario: "Experiência incrível! A Gramado Diferente nos levou aos melhores lugares de Gramado. Conhecimento excepcional e atendimento personalizado. Recomendo muito!",
    passeio: "City Tour Gramado"
  },
  {
    id: 2,
    nome: "João Santos",
    foto: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face",
    avaliacao: 5,
    comentario: "Serviço exemplar! Nos sentimos seguros e bem cuidados durante todo o passeio. As dicas da Gramado Diferente foram valiosas e tornaram nossa viagem inesquecível.",
    passeio: "Terra Mágica Florybal"
  },
  {
    id: 3,
    nome: "Ana Costa",
    foto: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop&crop=face",
    avaliacao: 5,
    comentario: "Simplesmente perfeito! A equipe da Gramado Diferente conhece cada cantinho da serra gaúcha. Fotos incríveis e momentos únicos. Já estamos planejando voltar!",
    passeio: "Cristais de Gramado"
  },
  {
    id: 4,
    nome: "Carlos Oliveira",
    foto: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face",
    avaliacao: 5,
    comentario: "Empresa excepcional! A Gramado Diferente transformou nossa lua de mel em algo mágico. Conhecem os melhores restaurantes e pontos turísticos. Serviço de primeira!",
    passeio: "Cristais de Gramado"
  },
  {
    id: 5,
    nome: "Fernanda Lima",
    foto: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=150&h=150&fit=crop&crop=face",
    avaliacao: 4,
    comentario: "Adoramos cada momento! A Gramado Diferente é muito atenciosa e conhece histórias fascinantes sobre cada lugar. Uma experiência cultural rica e divertida.",
    passeio: "Grupo Dreams"
  },
  {
    id: 6,
    nome: "Roberto Mendes",
    foto: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&h=150&fit=crop&crop=face",
    avaliacao: 5,
    comentario: "Profissionalismo e simpatia em cada detalhe. A Gramado Diferente nos ajudou a descobrir lugares que jamais encontraríamos sozinhos. Valeu cada centavo!",
    passeio: "Transfer Privativo"
  },
  {
    id: 7,
    nome: "Juliana Ferreira",
    foto: "https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?w=150&h=150&fit=crop&crop=face",
    avaliacao: 5,
    comentario: "Viagem dos sonhos! A Gramado Diferente superou todas as expectativas. Cuidaram de todos os detalhes e nos proporcionaram momentos únicos em família.",
    passeio: "Mini Mundo"
  },
  {
    id: 8,
    nome: "Pedro Almeida",
    foto: "https://images.unsplash.com/photo-1519244703995-f4e0f30006d5?w=150&h=150&fit=crop&crop=face",
    avaliacao: 5,
    comentario: "Excelente empresa! Pontuais, educados e muito conhecedores da região. A Gramado Diferente fez nossa viagem corporativa ser um sucesso total. Recomendamos!",
    passeio: "Ensaio Fotográfico"
  }
];
---

<section id="depoimentos" class="py-16 lg:py-20 bg-gray-50 dark:bg-gray-800">
  <div class="container mx-auto px-4">
    <div class="text-center mb-12">
      <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 dark:text-white mb-4">
        O que nossos <span class="text-primary-600 dark:text-primary-400">clientes</span> dizem
      </h2>
      <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
        Depoimentos reais de quem viveu experiências incríveis
      </p>
    </div>

    <!-- Container do carrossel de depoimentos -->
    <div class="relative overflow-hidden">
      <div id="testimonials-container" class="flex transition-transform duration-500 ease-in-out">
        {depoimentos.map((depoimento) => (
          <div class="flex-none w-full sm:w-1/2 lg:w-1/3 px-3">
            <div class="bg-white dark:bg-gray-900 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 h-full">
              <!-- Header com foto e info -->
              <div class="flex items-center mb-4">
                <img 
                  src={depoimento.foto} 
                  alt={depoimento.nome}
                  class="w-12 h-12 rounded-full object-cover mr-4"
                />
                <div class="flex-1">
                  <h3 class="font-semibold text-gray-900 dark:text-white">
                    {depoimento.nome}
                  </h3>
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    {depoimento.passeio}
                  </p>
                </div>
              </div>

              <!-- Avaliação em estrelas -->
              <div class="flex flex-col mb-4">
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1"><strong>Nossos Clientes Recomendam:</strong></p>
                <div class="flex items-center">
                  {Array.from({ length: 5 }, (_, i) => (
                    <svg 
                      class={`w-5 h-5 ${
                        i < depoimento.avaliacao 
                          ? 'text-yellow-400 fill-current' 
                          : 'text-gray-300 dark:text-gray-600'
                      }`} 
                      viewBox="0 0 20 20"
                    >
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                  ))}
                  <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">
                    {depoimento.avaliacao}.0
                </span>
              </div>
            </div>

            <!-- Comentário -->
              <blockquote class="text-gray-700 dark:text-gray-300 italic leading-relaxed">
                "{depoimento.comentario}"
              </blockquote>
            </div>
          </div>
        ))}
      </div>

      <!-- Controles de navegação - ocultos no mobile -->
      <button 
        id="testimonials-prev-btn"
        class="absolute left-4 top-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 shadow-lg rounded-full p-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors z-10 hidden sm:block"
      >
        <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      
      <button 
        id="testimonials-next-btn"
        class="absolute right-4 top-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 shadow-lg rounded-full p-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors z-10 hidden sm:block"
      >
        <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>

    <!-- Indicadores -->
    <div class="flex justify-center mt-8 space-x-2" id="testimonials-indicators">
      <!-- Indicadores serão gerados dinamicamente pelo JavaScript -->
    </div>
  </div>
</section>

<script>
  // Funcionalidade do carrossel de depoimentos
  let currentTestimonialSlide = 0;
  const testimonialsContainer = document.getElementById('testimonials-container');
  const testimonialsPrevBtn = document.getElementById('testimonials-prev-btn');
  const testimonialsNextBtn = document.getElementById('testimonials-next-btn');
  
  // Variáveis para touch/swipe
  let startX = 0;
  let currentX = 0;
  let isDragging = false;
  
  // Calcular quantos slides cabem na tela
  function getTestimonialsSlidesPerView() {
    const width = window.innerWidth;
    if (width >= 1024) return 3; // lg
    if (width >= 640) return 2;  // sm
    return 1; // mobile
  }
  
  function getTotalTestimonialsSlides() {
    return Math.ceil(8 / getTestimonialsSlidesPerView());
  }
  
  function updateTestimonialsCarousel() {
    const slidesPerView = getTestimonialsSlidesPerView();
    const totalSlides = getTotalTestimonialsSlides();
    const slideWidth = 100 / slidesPerView;
    const translateX = -currentTestimonialSlide * slideWidth;
    testimonialsContainer.style.transform = `translateX(${translateX}%)`;
    
    // Atualizar indicadores dinamicamente
    const indicatorsContainer = document.getElementById('testimonials-indicators');
    indicatorsContainer.innerHTML = '';
    
    for (let i = 0; i < totalSlides; i++) {
      const indicator = document.createElement('button');
      indicator.className = `w-3 h-3 rounded-full transition-colors ${
        i === currentTestimonialSlide ? 'bg-primary-600' : 'bg-gray-300 dark:bg-gray-600'
      }`;
      indicator.addEventListener('click', () => {
        currentTestimonialSlide = i;
        updateTestimonialsCarousel();
      });
      indicatorsContainer.appendChild(indicator);
    }
  }
  
  function nextTestimonialSlide() {
    const totalSlides = getTotalTestimonialsSlides();
    currentTestimonialSlide = (currentTestimonialSlide + 1) % totalSlides;
    updateTestimonialsCarousel();
  }
  
  function prevTestimonialSlide() {
    const totalSlides = getTotalTestimonialsSlides();
    currentTestimonialSlide = (currentTestimonialSlide - 1 + totalSlides) % totalSlides;
    updateTestimonialsCarousel();
  }
  
  // Touch/Swipe handlers
  function handleTestimonialsStart(e) {
    startX = e.touches[0].clientX;
    isDragging = true;
    testimonialsContainer.style.transition = 'none';
  }
  
  function handleTestimonialsMove(e) {
    if (!isDragging) return;
    
    currentX = e.touches[0].clientX;
    const diffX = currentX - startX;
    const containerWidth = testimonialsContainer.offsetWidth;
    const slideWidth = containerWidth / getTestimonialsSlidesPerView();
    
    const currentTranslate = -currentTestimonialSlide * (100 / getTestimonialsSlidesPerView());
    const movePercent = (diffX / slideWidth) * (100 / getTestimonialsSlidesPerView());
    
    testimonialsContainer.style.transform = `translateX(${currentTranslate + movePercent}%)`;
  }
  
  function handleTestimonialsEnd(e) {
    if (!isDragging) return;
    
    isDragging = false;
    testimonialsContainer.style.transition = 'transform 0.3s ease-in-out';
    
    const diffX = currentX - startX;
    const threshold = 50;
    
    if (Math.abs(diffX) > threshold) {
      if (diffX > 0) {
        prevTestimonialSlide();
      } else {
        nextTestimonialSlide();
      }
    } else {
      updateTestimonialsCarousel();
    }
  }
  
  // Event listeners
  testimonialsNextBtn?.addEventListener('click', nextTestimonialSlide);
  testimonialsPrevBtn?.addEventListener('click', prevTestimonialSlide);
  
  // Touch events
  testimonialsContainer.addEventListener('touchstart', handleTestimonialsStart, { passive: true });
  testimonialsContainer.addEventListener('touchmove', handleTestimonialsMove, { passive: true });
  testimonialsContainer.addEventListener('touchend', handleTestimonialsEnd, { passive: true });
  
  // Auto-play
  let testimonialsAutoPlay = setInterval(nextTestimonialSlide, 6000);
  
  testimonialsContainer.addEventListener('touchstart', () => {
    clearInterval(testimonialsAutoPlay);
  });
  
  testimonialsContainer.addEventListener('touchend', () => {
    testimonialsAutoPlay = setInterval(nextTestimonialSlide, 6000);
  });
  
  // Inicializar
  updateTestimonialsCarousel();
  
  // Atualizar no resize
  window.addEventListener('resize', () => {
    currentTestimonialSlide = 0;
    updateTestimonialsCarousel();
  });
</script>